# =============================================================================
# Mosquitto MQTT Broker Konfiguration
# =============================================================================
# Diese Datei konfiguriert den Eclipse Mosquitto MQTT Broker.
# Mosquitto ist ein leichtgewichtiger MQTT-Broker fuer IoT und Messaging.
#
# Dokumentation: https://mosquitto.org/man/mosquitto-conf-5.html
# =============================================================================

# -----------------------------------------------------------------------------
# Allgemeine Einstellungen
# -----------------------------------------------------------------------------

# Prozess-ID Datei (innerhalb des Containers)
pid_file /var/run/mosquitto/mosquitto.pid

# -----------------------------------------------------------------------------
# Netzwerk-Listener
# -----------------------------------------------------------------------------
# Definiert die Ports und Protokolle, auf denen der Broker lauscht.

# MQTT Standard-Protokoll auf Port 1883
# Verwendet fuer die meisten MQTT-Clients
listener 1883

# WebSocket-Protokoll auf Port 9001
# Ermoeglicht Browser-basierte MQTT-Clients (z.B. MQTT.js, Paho)
listener 9001
protocol websockets

# -----------------------------------------------------------------------------
# Persistenz (Datenspeicherung)
# -----------------------------------------------------------------------------
# Speichert Nachrichten und Subscriptions dauerhaft.
# Ermoeglicht Wiederherstellung nach Neustart.

# Persistenz aktivieren
persistence true

# Speicherort fuer persistente Daten
persistence_location /mosquitto/data/

# Persistenz-Datei
persistence_file mosquitto.db

# Autosave-Intervall in Sekunden (0 = nur bei Shutdown)
# Speichert alle 30 Minuten oder bei sauberem Herunterfahren
autosave_interval 1800

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Konfiguration der Log-Ausgabe fuer Debugging und Monitoring.

# Log-Datei (innerhalb des Containers)
log_dest file /mosquitto/log/mosquitto.log

# Zusaetzlich auch auf stdout loggen (fuer Docker-Logs)
log_dest stdout

# Log-Level: debug, error, warning, notice, information, subscribe, unsubscribe, all
# Fuer Produktion: error, warning, notice
# Fuer Entwicklung: notice, subscribe, unsubscribe
log_type error
log_type warning
log_type notice
log_type information

# Zeitstempel in Logs aktivieren
log_timestamp true

# Format: ISO 8601 Zeitstempel
log_timestamp_format %Y-%m-%dT%H:%M:%S

# -----------------------------------------------------------------------------
# Authentifizierung und Sicherheit
# -----------------------------------------------------------------------------
# WICHTIG: Diese Einstellungen sind fuer Entwicklungsumgebungen gedacht.
# Fuer Produktion sollte Authentifizierung aktiviert werden!

# Anonyme Verbindungen erlauben
# true  = Keine Authentifizierung erforderlich (Entwicklung)
# false = Authentifizierung erforderlich (Produktion)
allow_anonymous true

# Passwort-Datei fuer Benutzer-Authentifizierung
# Aktivieren Sie diese Zeile und deaktivieren Sie allow_anonymous fuer Produktion:
# password_file /mosquitto/config/passwd

# ACL-Datei fuer Zugriffsrechte (Access Control List)
# Definiert welche Benutzer auf welche Topics zugreifen duerfen:
# acl_file /mosquitto/config/acl

# -----------------------------------------------------------------------------
# Client-Einstellungen
# -----------------------------------------------------------------------------

# Maximale Anzahl gleichzeitiger Verbindungen (-1 = unbegrenzt)
max_connections -1

# Maximale Groesse einer einzelnen Nachricht in Bytes (256 MB Standard)
message_size_limit 268435456

# Maximale Anzahl von QoS 1 und QoS 2 Nachrichten in der Warteschlange
# pro Client (0 = unbegrenzt, Vorsicht bei Speicherverbrauch)
max_queued_messages 1000

# Maximale Anzahl von QoS 0 Nachrichten in der Warteschlange
max_queued_bytes 0

# Sitzungsablauf fuer persistente Sitzungen in Sekunden
# 0 = Sitzungen laufen nie ab
persistent_client_expiration 0

# =============================================================================
# Produktion-Hinweise
# =============================================================================
# Fuer produktive Umgebungen sollten folgende Aenderungen vorgenommen werden:
#
# 1. Authentifizierung aktivieren:
#    - allow_anonymous false
#    - password_file /mosquitto/config/passwd
#    - Passwort-Datei erstellen: mosquitto_passwd -c /mosquitto/config/passwd username
#
# 2. TLS/SSL aktivieren (erfordert Zertifikate):
#    - cafile /mosquitto/config/certs/ca.crt
#    - certfile /mosquitto/config/certs/server.crt
#    - keyfile /mosquitto/config/certs/server.key
#    - listener 8883 (fuer MQTT ueber TLS)
#    - listener 8884 (fuer WebSocket ueber TLS)
#
# 3. ACL konfigurieren fuer Topic-basierte Zugriffsrechte
#
# 4. Log-Level reduzieren auf error und warning
# =============================================================================
